import{G as x,d as ue,Z as re,g as ie,r as i,s as de,I as me,a as ce,f as u,K as E,c as T,o as _,h as l,w as o,M as D,m as c,t as p,j as t,x as C,y as pe,l as fe,B as ge,i as be,F as _e,A as ye}from"./index-SiRIT6sV.js";import{b as $e}from"./bucket-CCLSOPoM.js";function ve(y){return x({url:"/upload/list",method:"get",params:y})}const A=y=>x({url:"/upload",method:"post",headers:{"Content-Type":"multipart/form-data"},data:y});function ke(y){return x({url:`/upload/delete/${y}`,method:"delete"})}const he={class:"app-container"},Ce=["placeholder"],Ne=ue({name:"user"}),xe=Object.assign(Ne,{setup(y){const{companyCode:z}=JSON.parse(re()),{proxy:e}=ie(),V=i([]),F=i([]);i([]);const $=i(!1),N=i(!0),P=i(0),U=i(""),f=i(!1),j=i(1),R=i(10),L=i([]),M=i();M.value=[{statusCode:0,statusName:e.$t("common.no")},{statusCode:1,statusName:e.$t("common.yes")}];const O=s=>{r.value.file=s.target.files[0]},q=de({queryParams:{page:0,limit:15,query:""},form:{fileName:"",file:null,bucketId:void 0,username:z},rules:{fileName:[{required:!0,min:5,max:20,message:`${e.$t("menu.min5Max20")}`,trigger:"blur"}],bucketId:[{required:!0,message:`${e.$t("menu.notEmpty")}`,trigger:"blur"}],file:[{required:!0,message:`${e.$t("menu.notEmpty")}`,trigger:"blur"}]}}),{queryParams:v,rules:G,form:r}=me(q);ce();const J=()=>{$e().then(s=>{F.value=s.data})},g=(s=1)=>{N.value=!0,ve(q.queryParams).then(a=>{N.value=!1,V.value=a.data,P.value=a.meta.total})},K=s=>{j.value=s,e.$nextTick(()=>{g(s)})},Z=s=>{R.value=s,e.$nextTick(()=>{g()})},H=()=>{f.value=!0,U.value=e.$t("system.Add New")},Q=()=>{e.$refs.formRef.validate(s=>{if(s)if($.value=!0,r.value.id!==void 0&&r.value.id>0)A(r.value).then(a=>{f.value=!1,a.statusCode==200?(e.$modal.msgSuccess(e.$t("system.Success")),$.value=!1,g()):(e.$modal.msgError(e.$t("system.Failed")),$.value=!1)});else{const a=new FormData;a.append("fileName",r.value.fileName),a.append("file",r.value.file),a.append("bucketId",r.value.bucketId),a.append("username",z),A(a).then(k=>{f.value=!1,k.statusCode==200?(e.$modal.msgSuccess(e.$t("system.Success")),$.value=!1,g()):(e.$modal.msgError(e.$t("system.Failed")),$.value=!1)})}})},W=s=>{const a=s.id||a.value;e.$confirm(e.$t("system.Do you want to delete")+` = ${a} ?`,e.$t("system.System Message"),{confirmButtonText:e.$t("yes"),cancelButtonText:e.$t("no"),type:"warning"}).then(()=>ke(a)).then(k=>{k.status==200?(e.$modal.msgSuccess(e.$t("system.Success")),g()):e.$modal.msgError(e.$t("system.Failed"))})};return g(),J(),(s,a)=>{const k=u("UploadFilled"),X=u("el-icon"),h=u("el-button"),b=u("el-col"),B=u("el-input"),w=u("el-row"),d=u("el-table-column"),I=u("el-tag"),Y=u("el-table"),ee=u("el-pagination"),S=u("el-form-item"),te=u("el-option"),le=u("el-select"),ae=u("el-form"),oe=u("el-dialog"),ne=E("hasPermi"),se=E("loading");return _(),T("div",he,[l(w,{gutter:24},{default:o(()=>[l(b,{lg:24,xm:24},{default:o(()=>[l(w,{gutter:10,class:"mb8"},{default:o(()=>[l(b,{span:1.5},{default:o(()=>[l(h,{type:"primary",plain:"",size:"small",onClick:H},{default:o(()=>[l(X,{style:{"font-size":"15px"}},{default:o(()=>[l(k)]),_:1}),c(" "+p(s.$t("btn.upload")),1)]),_:1})]),_:1}),l(b,{span:1.5},{default:o(()=>[l(B,{modelValue:t(v).query,"onUpdate:modelValue":a[0]||(a[0]=n=>t(v).query=n),placeholder:t(e).$t("btn.search"),clearable:"","prefix-icon":"el-icon-search",style:{"margin-bottom":"20px"}},null,8,["modelValue","placeholder"])]),_:1}),l(b,{span:1.5},{default:o(()=>[l(h,{type:"primary",icon:"search",size:"small",onClick:a[1]||(a[1]=n=>g(1))},{default:o(()=>[c(p(s.$t("btn.search")),1)]),_:1})]),_:1})]),_:1}),D((_(),C(Y,{style:{height:"75vh"},data:t(V),"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"}},{default:o(()=>[l(d,{label:t(e).$t("company.card.id"),align:"center",key:"id",width:"50",prop:"id"},null,8,["label"]),l(d,{label:t(e).$t("menu.bucketName"),align:"center",key:"fileName",prop:"fileName"},{default:o(n=>{var m;return[c(p((m=n.row)==null?void 0:m.bucket.bucketProject),1)]}),_:1},8,["label"]),l(d,{label:t(e).$t("menu.fileName"),key:"fileName",prop:"fileName"},null,8,["label"]),l(d,{label:t(e).$t("menu.path"),key:"filePath",prop:"filePath"},null,8,["label"]),l(d,{label:t(e).$t("menu.originalFile"),key:"originalFile",prop:"originalFile"},null,8,["label"]),l(d,{label:t(e).$t("menu.type"),key:"mimeType",prop:"mimeType"},null,8,["label"]),l(d,{label:t(e).$t("menu.size"),key:"fileSize",prop:"fileSize"},null,8,["label"]),t(L).showColumn("createdAt")?(_(),C(d,{key:0,label:t(e).$t("createon"),align:"center",prop:"createdAt",width:"200"},{default:o(n=>{var m;return[c(p((m=n.row)==null?void 0:m.createdAt),1)]}),_:1},8,["label"])):pe("",!0),l(d,{label:t(e).$t("menu.createBy"),align:"center",key:"username",prop:"username"},null,8,["label"]),l(d,{label:t(e).$t("common.status"),align:"center"},{default:o(n=>{var m;return[((m=n.row)==null?void 0:m.status)=="success"?(_(),C(I,{key:0,type:"success"},{default:o(()=>[c(p(t(e).$t("menu.success")),1)]),_:1})):(_(),C(I,{key:1,type:"danger"},{default:o(()=>[c(p(t(e).$t("menu.failed")),1)]),_:1}))]}),_:1},8,["label"]),l(d,{label:t(e).$t("action"),align:"center",width:"150","class-name":"small-padding fixed-width"},{default:o(n=>[D(l(h,{size:"small",text:"",icon:"delete",title:s.$t("btn.delete"),onClick:fe(m=>W(n.row),["stop"])},null,8,["title","onClick"]),[[ne,["upload:bucket:delete"]]])]),_:1},8,["label"])]),_:1},8,["data"])),[[se,t(N)]]),l(ee,{"current-page":t(v).page,"onUpdate:currentPage":a[2]||(a[2]=n=>t(v).page=n),"page-size":t(v).limit,"onUpdate:pageSize":a[3]||(a[3]=n=>t(v).limit=n),"page-sizes":[100,200,300,400],small:!0,disabled:s.disabled,background:"var(--el-fill-color-light)",layout:"total, sizes, prev, pager, next, jumper",total:t(P),onSizeChange:K,onCurrentChange:Z},null,8,["current-page","page-size","disabled","total"])]),_:1}),l(oe,{title:t(U),modelValue:t(f),"onUpdate:modelValue":a[7]||(a[7]=n=>ge(f)?f.value=n:null),width:"600px","append-to-body":"","close-on-click-modal":!1},{footer:o(()=>[l(h,{text:"",onClick:a[6]||(a[6]=n=>f.value=!1)},{default:o(()=>[c(p(s.$t("btn.cancel")),1)]),_:1}),l(h,{type:"primary",loading:t($),onClick:Q},{default:o(()=>[c(p(s.$t("btn.submit")),1)]),_:1},8,["loading"])]),default:o(()=>[l(ae,{ref:"formRef",model:t(r),rules:t(G),"label-width":"100px"},{default:o(()=>[l(w,null,{default:o(()=>[l(b,{lg:20},{default:o(()=>[l(S,{label:t(e).$t("common.name"),prop:"fileName"},{default:o(()=>[l(B,{modelValue:t(r).fileName,"onUpdate:modelValue":a[4]||(a[4]=n=>t(r).fileName=n),placeholder:t(e).$t("system.Enter")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),l(b,{lg:20},{default:o(()=>[l(S,{label:t(e).$t("common.name"),prop:"file"},{default:o(()=>[be("input",{type:"file",placeholder:t(e).$t("system.Enter"),onChange:O,required:""},null,40,Ce)]),_:1},8,["label"])]),_:1}),l(b,{lg:20},{default:o(()=>[l(S,{label:t(e).$t("menu.bucketName"),prop:"bucketId"},{default:o(()=>[l(le,{modelValue:t(r).bucketId,"onUpdate:modelValue":a[5]||(a[5]=n=>t(r).bucketId=n),placeholder:"status",style:{width:"100%"}},{default:o(()=>[(_(!0),T(_e,null,ye(t(F),n=>(_(),C(te,{key:n.id,label:n.bucketProject+"-("+n.bucketName+")",value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])]),_:1})])}}});export{xe as default};
