import{l as he,a as $e,d as ke,r as we,b as Ce,u as Ve,c as xe}from"./user-CiOjqHtE.js";import{c as G}from"./role-BdMsILH9.js";import{d as Ue,g as Se,r as i,s as Ne,I as Re,H as Pe,f as m,K as j,c as U,o as u,h as n,w as o,i as K,j as l,M as $,x as d,m as C,t as V,y as c,ag as De,F as H,A as J,B as Ie}from"./index-SiRIT6sV.js";const Le={class:"app-container"},Te={class:"head-container"},qe={class:"head-container"},Ae={key:0},Fe={key:1},Me=Ue({name:"user"}),je=Object.assign(Me,{setup(Be){const{proxy:s}=Se();i([]);const S=i([]);S.value=[{dictCode:"M",dictLabel:"Male",dictValue:"M"},{dictCode:"F",dictLabel:"Female",dictValue:"F"}];const T=i([]),h=i(!1),N=i(!0);i(!0);const R=i([]),q=i(!0),A=i(!0),F=i(0),P=i(""),Q=i([]),z=i(""),M=i(void 0);i(void 0),i([]);const B=i([]),b=i([{key:0,label:"用户编号",visible:!0,prop:"id"},{key:1,label:"用户名称",visible:!0,prop:"username"},{key:2,label:"用户昵称",visible:!0,prop:"fname"},{key:3,label:"部门",visible:!0,prop:"country_code"},{key:4,label:"手机号码",visible:!0,prop:"phone"},{key:5,label:"状态",visible:!0,prop:"status"},{key:6,label:"创建时间",visible:!0,prop:"createdAt"},{key:7,label:"性别",visible:!1,prop:"sex"},{key:8,label:"头像",visible:!1,prop:"avatar"},{key:9,label:"邮箱",visible:!1,prop:"email"},{key:10,label:"最后登录时间",visible:!1,prop:"loginDate"}]),W=Ne({form:{},queryParams:{page:0,limit:10,username:void 0,phone:void 0,status:void 0,deptId:void 0,q:void 0},rules:{username:[{required:!0,message:"用户名称不能为空",trigger:"blur"},{min:2,max:20,message:"用户名称长度必须介于 2 和 20 之间",trigger:"blur"}],fname:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],password:[{required:!0,message:"用户密码不能为空",trigger:"blur"},{min:5,max:20,message:"用户密码长度必须介于 5 和 20 之间",trigger:"blur"}],email:[{required:!0,type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}]}}),{queryParams:y,form:r,rules:X}=Re(W),Y=(e,a)=>e?a.label.indexOf(e)!==-1:!0;Pe(z,e=>{s.$refs.deptTreeRef.filter(e)});function Z(){G().then(e=>{M.value=e.data}),G().then(e=>{console.log(e.data),B.value=e.data})}function x(){N.value=!0,he(s.addDateRange(y.value,Q.value)).then(e=>{N.value=!1,T.value=e.data,F.value=e.meta.total})}function ee(e){y.value.deptId=e.id,le()}function le(){y.value.num_page=1,x()}function O(e){const a=e.id||R.value;s.$modal.confirm('Are you sure to delete the user ID as"'+a+'"data item?',s.$t("btn.yes"),s.$t("btn.cancel")).then(function(){return ke(a)}).then(()=>{x(),s.$modal.msgSuccess("Success")}).catch(()=>{})}function te(e){s.$prompt(s.$t("user.changePwd")+" "+e.username,s.$t("system.System Message"),{confirmButtonText:s.$t("common.ok"),cancelButtonText:s.$t("common.cancel"),closeOnClickModal:!1,inputPattern:/^.{5,20}$/,inputErrorMessage:s.$t("system.Password Required")}).then(({value:a})=>{console.log(e),we({id:e.id,password:a,username:e.username}).then(_=>{s.$modal.msgSuccess(`${s.$t("system.Success")}`)})}).catch(()=>{})}function ae(e){s.$prompt("Assign Telegram Group "+e.username+" [9485850696,-30949494...]",s.$t("system.System Message"),{confirmButtonText:s.$t("common.ok"),cancelButtonText:s.$t("common.cancel"),closeOnClickModal:!1,inputPattern:/^.{5,100}$/,inputErrorMessage:s.$t("system.Password Required")}).then(({value:a})=>{console.log(e),Ce({id:e.id,tg_group:a}).then(_=>{s.$modal.msgSuccess(`${s.$t("system.Success")}`)})}).catch(()=>{})}function ne(e){R.value=e.map(a=>a.id),q.value=e.length!=1,A.value=!e.length}function D(){r.value={id:void 0,deptId:void 0,username:void 0,fname:void 0,password:void 0,phone:void 0,email:void 0,sex:"1",role_id:[],tg_group:void 0}}function oe(){h.value=!1,D()}function se(){D(),P.value=s.$t("user.create_user"),h.value=!0}function E(e){D();const a=e.id||R.value;$e(a).then(_=>{var f=_.data;r.value={id:f.id,username:f.username,fname:f.fname,lname:f.lname,password:"",phone:f.phone,email:f.email,sex:f.sex,roleId:f.roleId,tg_group:f.tg_group},h.value=!0,P.value=s.$t("user.update_user"),r.password=""})}function re(){s.$refs.userRef.validate(e=>{e&&(console.log("===="+r.value.id),r.value.id!==void 0?Ve(r.value).then(a=>{s.$modal.msgSuccess(s.$t("system.Success")),h.value=!1,x()}):xe(r.value).then(a=>{a.status==200?s.$modal.msgSuccess(s.$t("system.Success")):s.$modal.msgError(s.$t("system.Failed")),h.value=!1,x()}))})}function ue(e){console.log(e,JSON.stringify(this.form)),s.$forceUpdate()}return Z(),x(),(e,a)=>{const _=m("el-input"),f=m("el-tree"),p=m("el-col"),v=m("el-button"),I=m("el-row"),g=m("el-table-column"),de=m("dict-tag"),ie=m("el-icon"),me=m("el-table"),pe=m("pagination"),k=m("el-form-item"),ce=m("el-radio"),fe=m("el-radio-group"),ge=m("el-option"),_e=m("el-select"),be=m("el-form"),ye=m("el-dialog"),w=j("hasPermi"),ve=j("loading");return u(),U("div",Le,[n(I,{gutter:20},{default:o(()=>[n(p,{span:4,xs:24},{default:o(()=>[K("div",Te,[n(_,{modelValue:l(y).q,"onUpdate:modelValue":a[0]||(a[0]=t=>l(y).q=t),placeholder:"Search",clearable:"","prefix-icon":"el-icon-search",style:{"margin-bottom":"20px"}},null,8,["modelValue"])]),K("div",qe,[n(f,{data:l(M),props:{label:"label",children:"children"},"expand-on-click-node":!1,"filter-node-method":Y,ref:"deptTreeRef","default-expand-all":"",onNodeClick:ee},null,8,["data"])])]),_:1}),n(p,{lg:20,xm:24},{default:o(()=>[n(I,{gutter:10,class:"mb8"},{default:o(()=>[n(p,{span:1.5},{default:o(()=>[$((u(),d(v,{type:"primary",plain:"",icon:"Plus",onClick:se},{default:o(()=>[C(V(e.$t("btn.add")),1)]),_:1})),[[w,["system:user:add"]]])]),_:1}),n(p,{span:1.5},{default:o(()=>[$((u(),d(v,{type:"success",plain:"",icon:"Edit",disabled:l(q),onClick:E},{default:o(()=>[C(V(e.$t("btn.edit")),1)]),_:1},8,["disabled"])),[[w,["system:user:edit"]]])]),_:1}),n(p,{span:1.5},{default:o(()=>[$((u(),d(v,{type:"danger",plain:"",icon:"Delete",disabled:l(A),onClick:O},{default:o(()=>[C(V(e.$t("btn.delete")),1)]),_:1},8,["disabled"])),[[w,["system:user:delete"]]])]),_:1})]),_:1}),$((u(),d(me,{data:l(T),onSelectionChange:ne,"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"}},{default:o(()=>[n(g,{type:"selection",width:"50",align:"center"}),l(b).showColumn("id")?(u(),d(g,{label:"ID",align:"center",key:"id",prop:"id"})):c("",!0),l(b).showColumn("fname")?(u(),d(g,{label:l(s).$t("user.Frist Name"),align:"center",key:"fname",prop:"fname","show-overflow-tooltip":!0},null,8,["label"])):c("",!0),l(b).showColumn("lname")?(u(),d(g,{label:l(s).$t("user.Last Name"),align:"center",key:"lname",prop:"lname","show-overflow-tooltip":!0},null,8,["label"])):c("",!0),l(b).showColumn("username")?(u(),d(g,{label:l(s).$t("user.username"),align:"center",key:"username",prop:"username","show-overflow-tooltip":!0},null,8,["label"])):c("",!0),l(b).showColumn("tg_group")?(u(),d(g,{label:"TG Group",align:"left",key:"tg_group",prop:"tg_group",width:"350","show-overflow-tooltip":!0},{default:o(t=>[t.row.tg_group?(u(),U("span",Ae,"[ "+V(t.row.tg_group)+" ]",1)):(u(),U("span",Fe,"Unassigned"))]),_:1})):c("",!0),l(b).showColumn("createdAt")?(u(),d(g,{key:5,label:l(s).$t("create on"),align:"center",prop:"createdAt",width:"200"},null,8,["label"])):c("",!0),l(b).showColumn("sex")?(u(),d(g,{key:6,prop:"sex",label:"Sex",align:"center"},{default:o(t=>[n(de,{options:l(S),value:t.row.sex},null,8,["options","value"])]),_:1})):c("",!0),l(b).showColumn("email")?(u(),d(g,{key:7,prop:"email",label:"Email",align:"center"})):c("",!0),l(b).showColumn("loginDate")?(u(),d(g,{key:8,prop:"loginDate",label:"Last Login",align:"center"})):c("",!0),n(g,{label:"Action",align:"center",width:"200","class-name":"small-padding fixed-width"},{default:o(t=>[t.row.id!==0?$((u(),d(v,{key:0,text:"",icon:"Edit",onClick:L=>E(t.row)},null,8,["onClick"])),[[w,["system:user:edit"]]]):c("",!0),t.row.id!==0?$((u(),d(v,{key:1,text:"",icon:"Delete",onClick:L=>O(t.row)},null,8,["onClick"])),[[w,["system:user:delete"]]]):c("",!0),$(n(v,{text:"",icon:"Key",onClick:L=>te(t.row)},null,8,["onClick"]),[[w,["system:user:edit"]]]),$((u(),d(v,{onClick:L=>ae(t.row)},{default:o(()=>[n(ie,null,{default:o(()=>[n(l(De))]),_:1}),a[12]||(a[12]=C(" Assgin "))]),_:2},1032,["onClick"])),[[w,["system:user:edit"]]])]),_:1})]),_:1},8,["data"])),[[ve,l(N)]]),n(pe,{total:l(F),page:l(y).num_page,"onUpdate:page":a[1]||(a[1]=t=>l(y).num_page=t),limit:l(y).limit,"onUpdate:limit":a[2]||(a[2]=t=>l(y).limit=t),onPagination:x},null,8,["total","page","limit"])]),_:1})]),_:1}),n(ye,{title:l(P),modelValue:l(h),"onUpdate:modelValue":a[11]||(a[11]=t=>Ie(h)?h.value=t:null),"append-to-body":""},{footer:o(()=>[n(v,{text:"",onClick:oe},{default:o(()=>[C(V(e.$t("btn.cancel")),1)]),_:1}),n(v,{type:"primary",onClick:re},{default:o(()=>[C(V(e.$t("btn.submit")),1)]),_:1})]),default:o(()=>[n(be,{model:l(r),rules:l(X),ref:"userRef","label-width":"100px"},{default:o(()=>[n(I,{gutter:20},{default:o(()=>[n(p,{lg:12},{default:o(()=>[n(k,{label:e.$t("user.Frist Name"),prop:"fname"},{default:o(()=>[n(_,{modelValue:l(r).fname,"onUpdate:modelValue":a[3]||(a[3]=t=>l(r).fname=t),placeholder:e.$t("user.Frist Name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),n(p,{lg:12},{default:o(()=>[n(k,{label:e.$t("user.Last Name"),prop:"lname"},{default:o(()=>[n(_,{modelValue:l(r).lname,"onUpdate:modelValue":a[4]||(a[4]=t=>l(r).lname=t),placeholder:e.$t("user.Last Name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),n(p,{lg:12},{default:o(()=>[n(k,{label:"Gender"},{default:o(()=>[n(fe,{modelValue:l(r).sex,"onUpdate:modelValue":a[5]||(a[5]=t=>l(r).sex=t)},{default:o(()=>[(u(!0),U(H,null,J(l(S),t=>(u(),d(ce,{key:t.dictValue,label:t.dictValue},{default:o(()=>[C(V(t.dictLabel),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),n(p,{lg:12},{default:o(()=>[n(k,{label:"Role",prop:"roleId"},{default:o(()=>[n(_e,{modelValue:l(r).roleId,"onUpdate:modelValue":a[6]||(a[6]=t=>l(r).roleId=t),placeholder:"Role",style:{width:"100%"},onChange:a[7]||(a[7]=t=>ue(t))},{default:o(()=>[(u(!0),U(H,null,J(l(B),t=>(u(),d(ge,{key:t.id,label:t.role_name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),n(p,{lg:12},{default:o(()=>[n(k,{label:e.$t("user.username"),prop:"username"},{default:o(()=>[n(_,{disabled:l(r).id!=null,modelValue:l(r).username,"onUpdate:modelValue":a[8]||(a[8]=t=>l(r).username=t),placeholder:e.$t("user.username")},null,8,["disabled","modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),l(r).id==null?(u(),d(p,{key:0,lg:12},{default:o(()=>[n(k,{label:e.$t("user.password"),prop:"password"},{default:o(()=>[n(_,{modelValue:l(r).password,"onUpdate:modelValue":a[9]||(a[9]=t=>l(r).password=t),placeholder:e.$t("user.password"),type:"password"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})):c("",!0),n(p,{lg:12},{default:o(()=>[n(k,{label:"TG Group",prop:"tg_group"},{default:o(()=>[n(_,{modelValue:l(r).tg_group,"onUpdate:modelValue":a[10]||(a[10]=t=>l(r).tg_group=t),type:"textarea",placeholder:"-3898595955,98598585,...."},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{je as default};
