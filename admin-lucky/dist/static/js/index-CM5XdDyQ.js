import{_ as Me,d as ze,g as Le,r,s as J,I as Ee,H as Fe,a as Pe,f as d,K as W,c as C,o as g,M as V,h as t,O as X,j as a,w as n,k as Be,m as i,t as c,x as B,B as k,y as q,l as Y,i as qe,F as Ie,A as Oe,ae as Qe,af as je}from"./index-SiRIT6sV.js";import{l as He,g as Ge,d as Je,u as We,a as Xe,b as Ye}from"./role-BdMsILH9.js";const Ze={class:"app-container"},el={key:0},ll={key:1},tl={key:0},ol={class:"el-dropdown-link"},nl=ze({name:"role"}),al=Object.assign(nl,{setup(sl){const{proxy:u}=Le(),U=r(!0),N=r([]),Z=r(!0),ee=r(!0),$=r(!0),T=r(0),A=r([]),D=r(""),y=r(!1),M=r(!0),z=r(!1);r(!0),r(!1);const I=r([]),O=r([]),v=r(!1);r([{dictValue:"1",dictLabel:"all"},{dictValue:"2",dictLabel:"custom"},{dictValue:"3",dictLabel:"This department"},{dictValue:"4",dictLabel:"This department and below"},{dictValue:"5",dictLabel:"Only me"}]);const S=r([]);r([]);const _=J({page:0,limit:10,q:"",role_name:void 0,roleKey:void 0,status:void 0}),R=r(""),le=J({form:{},rules:{role_name:[{required:!0,message:"Role name cannot be empty",trigger:"blur"}]},defaultProps:{children:"children",label:"label"}}),te=r();r();const oe=r(),{form:s,rules:ne,defaultProps:ae}=Ee(le);Fe(R,l=>{u.$refs.menuRef.filter(l)});function h(){U.value=!0,He(u.addDateRange(_,I.value)).then(l=>{A.value=l.data,T.value=l.data.total,U.value=!1,console.log(A.value)})}function se(){const l=u.$refs.menuRef.getCheckedKeys(),e=u.$refs.menuRef.getHalfCheckedKeys();return l.unshift.apply(l,e),l}function L(){y.value=!1,v.value=!1,x()}function x(){s.value={id:void 0,role_name:void 0,role_status:"0"},u.resetForm("form")}function E(){_.pageNum=1,h()}function ue(){I.value=[],u.resetForm("queryForm"),E()}function re(l){N.value=l.map(e=>e.id),Z.value=l.length!=1,ee.value=!l.length}function de(l,e){switch(l){case"handleDataScope":he(e);break;case"handleAuthUser":ve(e);break}}function ie(l,e){{const f=S.value;for(let m=0;m<f.length;m++)u.$refs.menuRef.store.nodesMap[f[m].id].expanded=l}}function me(l,e){u.$refs.menuRef.setCheckedNodes(l?S.value:[])}function ce(l,e){s.value.menuCheckStrictly=!!l}function fe(l){return je(l).then(e=>(S.value=e.data.menu,e))}function pe(l,e){return l?e.label.indexOf(l)!==-1:!0}function _e(){x(),y.value=!0,D.value=u.$t("user.create_user"),v.value=!1}function ye(l){x();const e=l.id||N.value;Ge(e).then(f=>{s.value=f.data,y.value=!0,D.value="Update Record"})}function he(l){if(l.id==1){v.value=!1;return}x(),v.value=!0;const e=l.id||N.value;fe(e).then(m=>{m.data.checkedKeys.forEach(w=>{Qe(()=>{u.$refs.menuRef.setChecked(w,!0,!1)})})}),s.value={id:l.id,role_name:l.role_name,roleKey:l.roleKey,menuCheckStrictly:l.menuCheckStrictly}}const ge=Pe();function ve(l){const e=l.id;ge.push({path:"/system/roleusers",query:{id:e}})}function be(){u.$refs.formRef.validate(l=>{l&&(s.value.id!==void 0&&s.value.id>0?(s.value.type="edit",We(s.value).then(e=>{u.$modal.msgSuccess("Success"),y.value=!1,h()})):(s.value.type="add",Xe(s.value).then(e=>{y.value=!1,e.statusCode==200?(u.$modal.msgSuccess(e.msg),h()):u.$modal.msgError(e.msg)})))})}function ke(){s.value.id!=null?(s.value.menuIds=se(),Ye(s.value).then(l=>{u.$modal.msgSuccess("修改成功"),h(),L()})):u.$modal.msgError("请选择角色")}function we(l){const e=l.id||e.value;u.$confirm(u.$t("system.Do you want to delete")+` = ${e} ?`,u.$t("system.System Message"),{confirmButtonText:u.$t("yes"),cancelButtonText:u.$t("no"),type:"warning"}).then(function(){return Je(e)}).then(()=>{h(),u.$modal.msgSuccess("删除成功")})}return h(),O.value=[{status_value:0,status_name:"Disabled"},{status_value:1,status_name:"Active"}],(l,e)=>{const f=d("el-input"),m=d("el-form-item"),p=d("el-button"),w=d("el-form"),K=d("el-col"),Ce=d("right-toolbar"),Q=d("el-row"),b=d("el-table-column"),j=d("el-tag"),Ve=d("arrow-down"),$e=d("el-icon"),Se=d("el-dropdown-item"),Re=d("el-dropdown-menu"),xe=d("el-dropdown"),Ke=d("el-table"),Ue=d("pagination"),Ne=d("el-radio"),Te=d("el-radio-group"),H=d("el-dialog"),F=d("el-checkbox"),Ae=d("el-tree"),G=W("hasPermi"),De=W("loading");return g(),C("div",Ze,[V(t(w,{model:a(_),ref:"queryForm",inline:!0},{default:n(()=>[t(m,{label:"Name",prop:"role_name"},{default:n(()=>[t(f,{modelValue:a(_).role_name,"onUpdate:modelValue":e[0]||(e[0]=o=>a(_).role_name=o),placeholder:"Enter role name",clearable:"",size:"small",onKeyup:Be(E,["enter"])},null,8,["modelValue"])]),_:1}),t(m,null,{default:n(()=>[t(p,{type:"primary",icon:"search",size:"small",onClick:E},{default:n(()=>[i(c(l.$t("btn.search")),1)]),_:1}),t(p,{icon:"refresh",size:"small",onClick:ue},{default:n(()=>[i(c(l.$t("btn.reset")),1)]),_:1})]),_:1})]),_:1},8,["model"]),[[X,a($)]]),t(Q,{gutter:10,class:"mb8"},{default:n(()=>[t(K,{span:1.5},{default:n(()=>[V((g(),B(p,{type:"primary",plain:"",icon:"plus",size:"small",onClick:_e},{default:n(()=>[i(c(l.$t("btn.add")),1)]),_:1})),[[G,["system:role:add"]]])]),_:1}),t(Ce,{showSearch:a($),"onUpdate:showSearch":e[1]||(e[1]=o=>k($)?$.value=o:null),onQueryTable:h},null,8,["showSearch"])]),_:1}),V((g(),B(Ke,{data:a(A),"highlight-current-row":"",onSelectionChange:re,"header-cell-style":{background:"var(--el-fill-color-light)",color:"var(--el-text-color-primary)"}},{default:n(()=>[t(b,{label:"ID",prop:"id",width:"80"}),t(b,{label:"Name",prop:"role_name"}),t(b,{label:"Role Key",prop:"role_key"}),t(b,{label:"Staus",align:"center",width:"90"},{default:n(o=>[o.row.role_status==1?(g(),C("div",el,[t(j,{class:"ml-2",type:"success"},{default:n(()=>e[16]||(e[16]=[i("Active")])),_:1})])):q("",!0),o.row.role_status==0?(g(),C("div",ll,[t(j,{class:"ml-2",type:"warning"},{default:n(()=>e[17]||(e[17]=[i("Inactive")])),_:1})])):q("",!0)]),_:1}),t(b,{label:a(u).$t("create on"),align:"center",prop:"createdAt",width:"200"},null,8,["label"]),t(b,{label:"Action",align:"center",width:"200"},{default:n(o=>[o.row.role_name!="admin"?(g(),C("div",tl,[t(p,{size:"small",text:"",icon:"edit",title:l.$t("btn.edit"),onClick:Y(P=>ye(o.row),["stop"])},null,8,["title","onClick"]),V(t(p,{size:"small",text:"",icon:"delete",title:l.$t("btn.delete"),onClick:Y(P=>we(o.row),["stop"])},null,8,["title","onClick"]),[[G,["system:role:remove"]]]),t(xe,{size:"small",onCommand:P=>de(P,o.row)},{dropdown:n(()=>[t(Re,null,{default:n(()=>[t(Se,{command:"handleDataScope",icon:"circle-check"},{default:n(()=>[i(c(l.$t("menu.menuPermi")),1)]),_:1})]),_:1})]),default:n(()=>[qe("span",ol,[i(c(l.$t("btn.more"))+" ",1),t($e,{class:"el-icon--right"},{default:n(()=>[t(Ve)]),_:1})])]),_:2},1032,["onCommand"])])):q("",!0)]),_:1})]),_:1},8,["data"])),[[De,a(U)]]),V(t(Ue,{total:a(T),page:a(_).pageNum,"onUpdate:page":e[2]||(e[2]=o=>a(_).pageNum=o),limit:a(_).pageSize,"onUpdate:limit":e[3]||(e[3]=o=>a(_).pageSize=o),onPagination:h},null,8,["total","page","limit"]),[[X,a(T)>0]]),t(H,{title:a(D),modelValue:a(y),"onUpdate:modelValue":e[7]||(e[7]=o=>k(y)?y.value=o:null),width:"600px","append-to-body":""},{footer:n(()=>[t(p,{text:"",onClick:L},{default:n(()=>[i(c(l.$t("btn.cancel")),1)]),_:1}),t(p,{type:"primary",onClick:be},{default:n(()=>[i(c(l.$t("btn.submit")),1)]),_:1})]),default:n(()=>[t(w,{ref_key:"formRef",ref:oe,model:a(s),rules:a(ne),"label-width":"100px"},{default:n(()=>[t(Q,null,{default:n(()=>[t(K,{lg:24},{default:n(()=>[t(m,{label:"Role Name",prop:"role_name"},{default:n(()=>[t(f,{modelValue:a(s).role_name,"onUpdate:modelValue":e[4]||(e[4]=o=>a(s).role_name=o),placeholder:"Enter.."},null,8,["modelValue"])]),_:1})]),_:1}),t(K,{lg:12},{default:n(()=>[t(m,{label:"Role Key",prop:"role_key",key:"role_key"},{default:n(()=>[t(f,{modelValue:a(s).role_key,"onUpdate:modelValue":e[5]||(e[5]=o=>a(s).role_key=o),placeholder:"Role Key"},null,8,["modelValue"])]),_:1})]),_:1}),t(K,{lg:12},{default:n(()=>[t(m,{label:"Status"},{default:n(()=>[t(Te,{modelValue:a(s).role_status,"onUpdate:modelValue":e[6]||(e[6]=o=>a(s).role_status=o)},{default:n(()=>[(g(!0),C(Ie,null,Oe(a(O),o=>(g(),B(Ne,{key:o.status_value,label:o.status_value},{default:n(()=>[i(c(o.status_name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),t(H,{title:"Assignment of role permissions",modelValue:a(v),"onUpdate:modelValue":e[15]||(e[15]=o=>k(v)?v.value=o:null),width:"500px"},{footer:n(()=>[t(p,{text:"",onClick:L},{default:n(()=>[i(c(l.$t("btn.cancel")),1)]),_:1}),t(p,{type:"primary",onClick:ke},{default:n(()=>[i(c(l.$t("btn.save")),1)]),_:1})]),default:n(()=>[t(w,{model:a(s),"label-width":"80px"},{default:n(()=>[t(m,{label:"menu search"},{default:n(()=>[t(f,{placeholder:"Please enter keywords to filter",modelValue:a(R),"onUpdate:modelValue":e[8]||(e[8]=o=>k(R)?R.value=o:null)},null,8,["modelValue"])]),_:1}),t(m,{label:"permission character"},{default:n(()=>[i(c(a(s).roleKey),1)]),_:1}),t(m,{label:"Menu permissions"},{default:n(()=>[t(F,{modelValue:a(M),"onUpdate:modelValue":e[9]||(e[9]=o=>k(M)?M.value=o:null),onChange:e[10]||(e[10]=o=>ie(o,"menu"))},{default:n(()=>e[18]||(e[18]=[i("expand/collapse")])),_:1},8,["modelValue"]),t(F,{modelValue:a(z),"onUpdate:modelValue":e[11]||(e[11]=o=>k(z)?z.value=o:null),onChange:e[12]||(e[12]=o=>me(o,"menu"))},{default:n(()=>e[19]||(e[19]=[i("Select all/Not select all")])),_:1},8,["modelValue"]),t(F,{modelValue:a(s).menuCheckStrictly,"onUpdate:modelValue":e[13]||(e[13]=o=>a(s).menuCheckStrictly=o),onChange:e[14]||(e[14]=o=>ce(o,"menu"))},{default:n(()=>e[20]||(e[20]=[i("father-son linkage")])),_:1},8,["modelValue"]),t(Ae,{class:"tree-border",data:a(S),"show-checkbox":"",ref_key:"menuRef",ref:te,"node-key":"id","check-strictly":!a(s).menuCheckStrictly,"empty-text":"加载中，请稍后","filter-node-method":pe,props:a(ae)},null,8,["data","check-strictly","props"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),dl=Me(al,[["__scopeId","data-v-940edcee"]]);export{dl as default};
